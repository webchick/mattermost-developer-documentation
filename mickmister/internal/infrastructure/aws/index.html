<!DOCTYPE html>





<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title> AWS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">   
<meta http-equiv="content-language" content="en-us" />



<link rel="canonical" href="../../../internal/infrastructure/aws/">


<link rel="shortcut icon" type="image/png" href="../../../img/favicon-32x32.png" />

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">


<link rel="stylesheet" href="../../../css/bootstrap.min.css">
<link rel="stylesheet" href="../../../css/tabs.css">
<link rel="stylesheet" href="../../../css/bar.css">
<link rel="stylesheet" href="../../../css/styles.css">
<link rel="stylesheet" href="../../../css/code.css">
<link rel="stylesheet" href="../../../css/note.css">


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="../../../js/tabs.js"></script>
<script src="../../../js/main.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script async src="//cdn.bizible.com/scripts/bizible.js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-64458817-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-64458817-2');
</script>


<script type="text/javascript">
    (function() {
    var didInit = false;
    function initMunchkin() {
    if(didInit === false) {
    didInit = true;
    Munchkin.init('161-FBE-733');
    }
    }
    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
    initMunchkin();
    }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>


<script type="text/javascript" charset="utf-8">
    var _eiq = _eiq || [];
    var _engagio_settings = {
      accountId: "cb6a404b72e9141b70d1f82abc04db92b4e56238"
    };
    (function() {
      var ei = document.createElement('script'); ei.type = 'text/javascript'; ei.async = true;
      ei.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'web-analytics.engagio.com/js/ei.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ei, s);
    })();
  </script>

    </head>
<body>
    <header>
    <a href="../../../"><img src="../../../img/logo.svg" alt="Mattermost Logo" width="212px"></a>
    <div class="header__menu-toggle">
        <i class="fa fa-bars"></i>
    </div>
    <ul class="header__links--right">
        <li><a href="../../../">Home</a></li>
        
            
            
            
                
                    <li><a href="../../../contribute/getting-started">Contribute</a></li>
                
            
        
            
            
            
                
                    <li><a href="../../../integrate/getting-started">Integrate</a></li>
                
            
        
            
            
            
                
                    <li><a href="../../../extend/getting-started">Extend</a></li>
                
            
        
            
            
            
                
                    <li><a href="../../../blog">Blog</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://docs.mattermost.com/">Admin Docs</a></li>
                
            
        
    </ul>
</header>




    <div id="wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 sidebar">
    <div class="sidebar__menu-toggle">
        AWS
        <i class="fa fa-bars pull-right"></i>
    </div>
    <div class="row sidebar__links">
        
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="../../../internal/infrastructure/"> Infrastructure</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                            
                                <a href="../../../internal/infrastructure/kubernetes/"> Kubernetes</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                                <a class="item " href="../../../internal/infrastructure/kubernetes/kubernetes-troubleshooting/">Kubernetes Maintenance</a>
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/infrastructure/grafana/"> Community Grafana</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/infrastructure/vpn-cloud/"> VPN(CLOUD)</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/infrastructure/vpn/"> VPN</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/infrastructure/vault/"> Vault</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/infrastructure/plugins/"> Adding a Plugin to Community</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        
                            
                        

                        
                            
                        

                        <span class="item active">
                            <i class="sub-menu__toggle fa fa-minus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a class="active" href="../../../internal/infrastructure/aws/"> AWS</a></span>
                            
                        </span>
                        <ul class="sub-menu" style="display: block">
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/infrastructure/onelogin-aws/"> OneLogin and AWS</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/infrastructure/build/"> Build</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/infrastructure/guidelines/"> Guidelines for New Infrastructure</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../internal/qa/"> QA</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../internal/offboarding/"> Offboarding</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="../../../internal/onboarding/"> Onboarding</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/onboarding/new-staff-guide/"> New Staff Guide</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/onboarding/manager-guide/"> Manager Guide</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="../../../internal/mobile-build-process/"> Mobile Build Process</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/mobile-build-process/bump-version-number/"> Bump Version Number</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/mobile-build-process/bump-build-number/"> Bump Build Number</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../internal/mobile-build-process/troubleshooting/"> Troubleshooting</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../internal/release-tagging-process/"> Release Tagging Process</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../internal/release-process/"> Release Cutting Process</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../internal/plugin-release-process/"> Plugin Release Process</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../internal/tips-and-best-practices/"> Tips and Best Practices</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../internal/writing-a-blog-post/"> Writing a Blog Post</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../internal/rd-teams/"> R&amp;D Teams</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../internal/sustained-engineering/"> Sustained Engineering Team</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
        
    </div>
</div>

                <div class="col-lg-9 doc-content">
                    
<a href="https://github.com/mattermost/mattermost-developer-documentation/edit/master/site/content/internal/infrastructure/aws.md" class="float-right edit-github">
    Edit on GitHub
</a>


                    <h1 class="mt-0 doc-title">
                        AWS
                    </h1>
                    <p>Most of our infrastructure is hosted in AWS.</p>
<h2 id="accessing-aws">Accessing AWS&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#accessing-aws"></i></a> </h2>
<p>You can sign into the web console for the master AWS account at this URL:</p>
<p><a href="https://mattermost.signin.aws.amazon.com/console">https://mattermost.signin.aws.amazon.com/console</a></p>
<p>After signing into the master account, you can access other accounts within the organization through role switching. This can be done from the dropdown on the right side of the console&rsquo;s menu bar, or you can use this link to switch to the developer account:</p>
<p><a href="https://signin.aws.amazon.com/switchrole?account=mattermost-dev&amp;roleName=DeveloperRole&amp;displayName=mattermost-dev">https://signin.aws.amazon.com/switchrole?account=mattermost-dev&amp;roleName=DeveloperRole&amp;displayName=mattermost-dev</a></p>
<p>This will require you to have signed in using MFA (When you first enable MFA, you&rsquo;ll have to sign out and back in again.).</p>
<p>Once you switch to another account for the first time, you can quickly switch back and forth through the menu bar dropdown.</p>
<h2 id="enabling-mfa-multi-factor-authentication">Enabling MFA (Multi-Factor Authentication)&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#enabling-mfa-multi-factor-authentication"></i></a> </h2>
<p>All developers that access AWS are required to enable MFA on their account(s). To enable MFA, follow these instructions:</p>
<ol>
<li>Download Authy, Google Authenticator, or any other MFA app for your smartphone of choice</li>
<li>Sign in to the AWS console with your username/password</li>
<li>From the &lsquo;Services&rsquo; dropdown in the top-left corner of the AWS Console, choose &lsquo;IAM&rsquo; from the &lsquo;Security, Identity, and Compliance&rsquo; section</li>
<li>Click on &lsquo;Users&rsquo; in the left-most column of the page</li>
<li>Find your username in the list of users in the centre of the page and click on it</li>
<li>Click on the &lsquo;Security Credentials&rsquo; tab on the &lsquo;Summary&rsquo; page that appears</li>
<li>Click on the pencil icon beside the &lsquo;Assigned MFA device&rsquo; label in the &lsquo;Sign-in credentials&rsquo; section</li>
<li>Follow the on-screen instructions to activate MFA on your device</li>
<li>Sign out of the AWS Console and sign back in</li>
</ol>
<h2 id="accessing-the-machines-on-aws">Accessing the Machines on AWS&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#accessing-the-machines-on-aws"></i></a> </h2>
<p>Most of the machines at the time of writing use an SSH key. If the description for the machine says it uses a key such as &ldquo;mm-admin&rdquo;, &ldquo;mm-ci&rdquo;, or &ldquo;mm-dev&rdquo;, you&rsquo;ll need to get that key from someone else.</p>
<p>If the machine does not have an SSH key associated with it, you&rsquo;ll need to generate an SSH key and have it signed by <a href="../vault">Vault</a>.</p>
<h2 id="creating-machines-on-aws">Creating Machines on AWS&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#creating-machines-on-aws"></i></a> </h2>
<p>Unless the machine is for your personal use only, use <a href="../vault">Vault</a> to control access to it: Create it <em>without</em> a key, then give it the following user data.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#09f;font-style:italic">#cloud-config</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#069;font-weight:bold">bootcmd</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- cloud-init-per<span style="color:#bbb"> </span>once<span style="color:#bbb"> </span>ssh-users-ca<span style="color:#bbb"> </span>echo<span style="color:#bbb"> </span><span style="color:#c30">&#34;TrustedUserCAKeys /etc/ssh/trusted_ca_keys.pub&#34;</span><span style="color:#bbb"> </span>&gt;&gt;<span style="color:#bbb"> </span>/etc/ssh/sshd_config<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#069;font-weight:bold">write_files</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#069;font-weight:bold">path</span>:<span style="color:#bbb"> </span>/etc/ssh/trusted_ca_keys.pub<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#069;font-weight:bold">content</span>:<span style="color:#bbb"> </span>ssh-rsa<span style="color:#bbb"> </span>AAAAB3NzaC1yc2EAAAADAQABAAACAQDHDwQhQ3eRiW4CV5RKAJb0n9P/07aHrku5hAVc+M59ejZHPVD/4sEfSaKvIXNTcY5TsrudzEhY3nVBsJDcJjb5qC5ayy+JNGFNnF05JoZ4E3tggJm5HQv3Znm/N6s65ZMA0HsZojCvEf+K8P0AKdJWiZbZGF095+N3WL9bUQIxBmCIBVPAOQSTCo8QKeorFfxhw/XcmH3s/KDV52/hEt6RWTxaDup03r7y8fbVo81F4QJ2ItmHgL3vGSpJk/nkLB2RWxT6zp4JIEo7PZ6S2Gm/2jaW+B5DftUd0gI8GKo9+vhtWjEEbOdu/mz92/GHLHW+s3TnftLeXVs7a8UYwdh/qJ4P64U3wlA//igo7ToXONsZ4TwmcKg6FD9JAq+LKTC0+prx/Gulx5esiPS+bgnkM/CMuoWMtucLoXaNz9ELBmeb6QSj1a7T/4LFzBiefT977OIhglORnEsKvY0HXvzX66a73Lm3bC9mUXxi1HSJNTDdLOmnVK+ipVjViy2/C9KJmKL3ePwBQSJ9d9IK76W4SGXTGT4mTVBSSF6j+/2a4tXq9c3NCuEWyXgPJRP1t6Iib42oAosxPoZ4zeBZM05BHbveD2b0G/bmeaZRgsEaZ3Qjnr50a6Wke7Vr9q3QGjn3+8QEdUdrnCTN8dlloLYhwY9pgh1JEYDaCdPHSP1ppw==<span style="color:#bbb">
</span></code></pre></div><h2 id="best-practices">Best Practices&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#best-practices"></i></a> </h2>
<ul>
<li>Do not configure services to use access keys that are associated with a human IAM user. Create separate IAM users for each service and write strict access policies for them.</li>
<li>Do not create multiple IAM users for yourself. There are extremely few legitimate reasons for a human to need a second IAM user.</li>
<li>Do not use access tokens if you can use IAM roles instead. For example, services running on an EC2 instance should almost never use tokens.</li>
<li>We can create new AWS accounts within seconds. Don&rsquo;t be afraid to ask for a clean one. New production services can be placed in their own account for increased security and isolation. If you need to dirty up an account with experiments or testing, you can also do so in a dedicated account.</li>
</ul>


                </div>
            </div>
        </div>
    </div>
    <footer class="text-center">
    <div class="container-fluid">
        <div class="footer__copyright">© Mattermost, Inc. All Rights Reserved.</div>
        <div class="footer__icons">
            <a href="https://www.facebook.com/Mattermost-2300985916642531/"><i class="fa fa-facebook"></i></a>
            <a href="https://twitter.com/mattermost"><i class="fa fa-twitter"></i></a>
            <a href="https://www.youtube.com/channel/UCNR05H72hi692y01bWaFXNA"><i class="fa fa-youtube"></i></a>
        </div>
    </div>
</footer>

</body>
</html>
