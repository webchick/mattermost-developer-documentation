<!DOCTYPE html>





<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title> Migrating Plugins</title>
<meta name="viewport" content="width=device-width, initial-scale=1">   
<meta http-equiv="content-language" content="en-us" />



<link rel="canonical" href="../../../extend/plugins/migration/">


<link rel="shortcut icon" type="image/png" href="../../../img/favicon-32x32.png" />

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">


<link rel="stylesheet" href="../../../css/bootstrap.min.css">
<link rel="stylesheet" href="../../../css/tabs.css">
<link rel="stylesheet" href="../../../css/bar.css">
<link rel="stylesheet" href="../../../css/styles.css">
<link rel="stylesheet" href="../../../css/code.css">
<link rel="stylesheet" href="../../../css/note.css">


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="../../../js/tabs.js"></script>
<script src="../../../js/main.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script async src="//cdn.bizible.com/scripts/bizible.js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-64458817-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-64458817-2');
</script>


<script type="text/javascript">
    (function() {
    var didInit = false;
    function initMunchkin() {
    if(didInit === false) {
    didInit = true;
    Munchkin.init('161-FBE-733');
    }
    }
    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
    initMunchkin();
    }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>


<script type="text/javascript" charset="utf-8">
    var _eiq = _eiq || [];
    var _engagio_settings = {
      accountId: "cb6a404b72e9141b70d1f82abc04db92b4e56238"
    };
    (function() {
      var ei = document.createElement('script'); ei.type = 'text/javascript'; ei.async = true;
      ei.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'web-analytics.engagio.com/js/ei.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ei, s);
    })();
  </script>

    </head>
<body>
    <header>
    <a href="../../../"><img src="../../../img/logo.svg" alt="Mattermost Logo" width="212px"></a>
    <div class="header__menu-toggle">
        <i class="fa fa-bars"></i>
    </div>
    <ul class="header__links--right">
        <li><a href="../../../">Home</a></li>
        
            
            
            
                
                    <li><a href="../../../contribute/getting-started">Contribute</a></li>
                
            
        
            
            
            
                
                    <li><a href="../../../integrate/getting-started">Integrate</a></li>
                
            
        
            
            
            
                
                    <li class="active"><a href="../../../extend/getting-started">Extend</a></li>
                
            
        
            
            
            
                
                    <li><a href="../../../blog">Blog</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://docs.mattermost.com/">Admin Docs</a></li>
                
            
        
    </ul>
</header>




    <div id="wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 sidebar">
    <div class="sidebar__menu-toggle">
        Migrating Plugins
        <i class="fa fa-bars pull-right"></i>
    </div>
    <div class="row sidebar__links">
        
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../extend/getting-started/"> Getting Started</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="../../../extend/customization/"> Customizing Mattermost</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/customization/server-build/"> Server Build (Team Edition)</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/customization/server-files/"> Server Files</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/customization/webapp/"> Web App</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                </ul>
            
                
                

                
                
                    
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-minus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="../../../extend/plugins/"> Plugins (Beta)</a>
                    
                </span>
                <ul class="sub-menu" style="display: block">
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/plugins/overview/"> Overview</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                            
                                <a href="../../../extend/plugins/server/"> Server Plugins</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                                <a class="item " href="../../../extend/plugins/server/hello-world/">Quick Start</a>
                            
                                <a class="item " href="../../../extend/plugins/server/reference/">Server Reference</a>
                            
                                <a class="item " href="../../../extend/plugins/server/ha/">High Availability</a>
                            
                                <a class="item " href="../../../extend/plugins/server/debugging/"></a>
                            
                                <a class="item " href="../../../extend/plugins/server/best-practices/">Best Practices</a>
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                            
                                <a href="../../../extend/plugins/webapp/"> Web App Plugins</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                                <a class="item " href="../../../extend/plugins/webapp/hello-world/">Quick Start</a>
                            
                                <a class="item " href="../../../extend/plugins/webapp/reference/">Web App Reference</a>
                            
                                <a class="item " href="../../../extend/plugins/webapp/actions/">Redux Actions</a>
                            
                                <a class="item " href="../../../extend/plugins/webapp/best-practices/">Design Best Practices</a>
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/plugins/manifest-reference/"> Manifest Reference</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/plugins/mobile/"> Mobile Plugins</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/plugins/example-plugins/"> Example Plugins</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        
                            
                        

                        
                            
                        

                        <span class="item active">
                            <i class="sub-menu__toggle fa fa-minus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a class="active" href="../../../extend/plugins/migration/"> Migrating Plugins</a></span>
                            
                        </span>
                        <ul class="sub-menu" style="display: block">
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/plugins/community_process/"> Process to Include Plugin on Community</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/plugins/community-plugin-marketplace/"> Community Plugins in the Marketplace</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/plugins/best-practices/"> Best Practices</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                        
                        

                        
                        

                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="../../../extend/plugins/helpers/"> Plugin Helpers</a></span>
                            
                        </span>
                        <ul class="sub-menu" >
                            
                        </ul>
                    
                </ul>
            
                
                

                
                

                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="../../../extend/embed/"> Embed</a>
                    
                </span>
                <ul class="sub-menu" >
                    
                </ul>
            
        
    </div>
</div>

                <div class="col-lg-9 doc-content">
                    
<a href="https://github.com/mattermost/mattermost-developer-documentation/edit/master/site/content/extend/plugins/migration.md" class="float-right edit-github">
    Edit on GitHub
</a>


                    <h1 class="mt-0 doc-title">
                        Migrating Plugins
                    </h1>
                    <h2 id="migrating-plugins-from-mattermost-55-and-earlier">Migrating Plugins from Mattermost 5.5 and earlier&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#migrating-plugins-from-mattermost-55-and-earlier"></i></a> </h2>
<p>The plugin package exposed by Mattermost 5.6 and later drops support for automatically unmarshalling a plugin&rsquo;s configuration onto the struct embedding <code>MattermostPlugin</code>. As server plugins are inherently concurrent (hooks being called asynchronously) and the plugin configuration can change at any time, access to the configuration must be synchronized.</p>
<p>Plugins compiled against 5.5 and earlier will continue to work without modification, automatically unmarshalling a plugin&rsquo;s configuration but with the existing risk of a corrupted read or write. Once the plugin is recompiled against Mattermost 5.6, it will be necessary to manually unmarshal your plugin&rsquo;s configuration. Client-only plugins and server plugins without public fields require no modifications.</p>
<p>Note that you do not need to wait until Mattermost 5.6 to make these changes, as the hardened approach explained below will work with Mattermost 5.5 and earlier. Any implementation of <code>OnConfigurationChange</code> you define overrides the one automatically unmarshalling.</p>
<h3 id="server-changes">Server changes&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#server-changes"></i></a> </h3>
<h4 id="loading-configuration">Loading configuration&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#loading-configuration"></i></a> </h4>
<p>Previously, any public fields defined on the struct embedding <code>MattermostPlugin</code> would be automatically unmarshalled from the plugin&rsquo;s configuration:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">type</span> Plugin <span style="color:#069;font-weight:bold">struct</span> {
    plugin.MattermostPlugin

    Greeting <span style="color:#078;font-weight:bold">string</span>
}


<span style="color:#069;font-weight:bold">func</span> (p <span style="color:#555">*</span>Plugin) <span style="color:#c0f">ServeHTTP</span>(c <span style="color:#555">*</span>plugin.Context, w http.ResponseWriter, r <span style="color:#555">*</span>http.Request) {
    fmt.<span style="color:#c0f">Fprintf</span>(w, <span style="color:#c30">&#34;Hello %s!&#34;</span>, p.Greeting)
}
</code></pre></div><p>Writing to <code>Greeting</code> while the plugin may be concurrently reading from same could result in a corrupted read or write. The <a href="https://github.com/mattermost/mattermost-plugin-starter-template">mattermost-plugin-starter-template</a> and <a href="https://github.com/mattermost/mattermost-plugin-demo">mattermost-plugin-demo</a> have both been updated with more complete examples, but the general idea is to manually handle the <code>OnConfigurationChange</code> hook and synchronize access to these variables. One such way is with a <a href="https://golang.org/pkg/sync/#RWMutex">sync.RWMutex</a>:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">type</span> Plugin <span style="color:#069;font-weight:bold">struct</span> {
    plugin.MattermostPlugin

    greetingLock sync.Mutex
    greeting <span style="color:#078;font-weight:bold">string</span>
}

<span style="color:#069;font-weight:bold">func</span> (p <span style="color:#555">*</span>Plugin) <span style="color:#c0f">OnConfigurationChange</span>() <span style="color:#078;font-weight:bold">error</span> {
    <span style="color:#069;font-weight:bold">type</span> configuration <span style="color:#069;font-weight:bold">struct</span> {
        Greeting <span style="color:#078;font-weight:bold">string</span>
    }

    <span style="color:#09f;font-style:italic">// Load the public configuration fields from the Mattermost server configuration.
</span><span style="color:#09f;font-style:italic"></span>    <span style="color:#069;font-weight:bold">if</span> err <span style="color:#555">:=</span> p.API.<span style="color:#c0f">LoadPluginConfiguration</span>(configuration); err <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> {
        <span style="color:#069;font-weight:bold">return</span> errors.<span style="color:#c0f">Wrap</span>(err, <span style="color:#c30">&#34;failed to load plugin configuration&#34;</span>)
    }

    p.configurationLock.<span style="color:#c0f">Lock</span>()
    <span style="color:#069;font-weight:bold">defer</span> p.configurationLock.<span style="color:#c0f">Unlock</span>()
    p.greeting = configuration.Greeting

    <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">nil</span>
}

<span style="color:#069;font-weight:bold">func</span> (p <span style="color:#555">*</span>Plugin) <span style="color:#c0f">ServeHTTP</span>(c <span style="color:#555">*</span>plugin.Context, w http.ResponseWriter, r <span style="color:#555">*</span>http.Request) {
    p.configurationLock.<span style="color:#c0f">RLock</span>()
    <span style="color:#069;font-weight:bold">defer</span> p.configurationLock.<span style="color:#c0f">RUnlock</span>()

    fmt.<span style="color:#c0f">Fprintf</span>(w, <span style="color:#c30">&#34;Hello %s!&#34;</span>, p.greeting)
}
</code></pre></div><p>Unfortunately, this adds a fair bit of extra complexity. You may wish to base your updated implementation off of <a href="https://github.com/mattermost/mattermost-plugin-starter-template">mattermost-plugin-starter-template</a> or <a href="https://github.com/mattermost/mattermost-plugin-demo">mattermost-plugin-demo</a> to simplify your code.</p>
<h2 id="migrating-plugins-from-mattermost-51-and-earlier">Migrating Plugins from Mattermost 5.1 and earlier&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#migrating-plugins-from-mattermost-51-and-earlier"></i></a> </h2>
<p>Mattermost 5.2 introduces breaking changes to the plugins beta. This page documents the changes necessary to migrate your existing plugins to be compatible with Mattermost 5.2 and later.</p>
<p>See <a href="https://github.com/mattermost/mattermost-plugin-zoom/compare/98eca6653e1a62c6b758e39b24d6ea075905c210...master">mattermost-plugin-zoom</a> for an example migration involving both a server and web app component.</p>
<h3 id="server-changes-1">Server changes&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#server-changes-1"></i></a> </h3>
<p>Although the underlying changes are significant, the required migration for server plugins is minimal.</p>
<h4 id="entry-point">Entry Point&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#entry-point"></i></a> </h4>
<p>The plugin entry point was previously:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">import</span> <span style="color:#c30">&#34;github.com/mattermost/mattermost-server/plugin/rpcplugin&#34;</span>

<span style="color:#069;font-weight:bold">func</span> <span style="color:#c0f">main</span>() {
    rpcplugin.<span style="color:#c0f">Main</span>(<span style="color:#555">&amp;</span>HelloWorldPlugin{})
}
</code></pre></div><p>Change the imported package and invoke <code>ClientMain</code> instead:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">import</span> <span style="color:#c30">&#34;github.com/mattermost/mattermost-server/plugin&#34;</span>

<span style="color:#069;font-weight:bold">func</span> <span style="color:#c0f">main</span>() {
    plugin.<span style="color:#c0f">ClientMain</span>(<span style="color:#555">&amp;</span>HelloWorldPlugin{})
}
</code></pre></div><h4 id="hook-parameters">Hook Parameters&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#hook-parameters"></i></a> </h4>
<p>Most hook callbacks now contain a leading <code>plugin.Context</code> parameter. Consult the <a href="../server/reference/#Hooks">Hooks</a> documentation for more details, but for example, the <code>ServeHTTP</code> hook was previously:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> (p <span style="color:#555">*</span>MyPlugin) <span style="color:#c0f">ServeHTTP</span>(w http.ResponseWriter, r <span style="color:#555">*</span>http.Request) {
    <span style="color:#09f;font-style:italic">// ...
</span><span style="color:#09f;font-style:italic"></span>}
</code></pre></div><p>Change it to:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> (p <span style="color:#555">*</span>MyPlugin) <span style="color:#c0f">ServeHTTP</span>(c <span style="color:#555">*</span>plugin.Context, w http.ResponseWriter, r <span style="color:#555">*</span>http.Request) {
    <span style="color:#09f;font-style:italic">// ...
</span><span style="color:#09f;font-style:italic"></span>}
</code></pre></div><h4 id="api-changes">API Changes&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#api-changes"></i></a> </h4>
<p>Most of the previous API calls remain available and unchanged, with the notable exception of removing the <code>KeyValueStore()</code>. Use <a href="../server/reference/#API.KVSet">KVSet</a>, <a href="../server/reference/#API.KVGet">KVGet</a> and <a href="../server/reference/#API.KVDelete">KVDelete</a> instead test:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> (p <span style="color:#555">*</span>MyPlugin) <span style="color:#c0f">ServeHTTP</span>(c <span style="color:#555">*</span>plugin.Context, w http.ResponseWriter, r <span style="color:#555">*</span>http.Request) {
    key <span style="color:#555">:=</span> r.URL.<span style="color:#c0f">Query</span>().<span style="color:#c0f">Get</span>(<span style="color:#c30">&#34;key&#34;</span>)
    <span style="color:#069;font-weight:bold">switch</span> r.Method {
    <span style="color:#069;font-weight:bold">case</span> http.MethodGet:
        value, _ <span style="color:#555">:=</span> p.API.<span style="color:#c0f">KVGet</span>(key)
        fmt.<span style="color:#c0f">Fprintf</span>(w, <span style="color:#366">string</span>(value))
    <span style="color:#069;font-weight:bold">case</span> http.MethodPut:
        value <span style="color:#555">:=</span> r.URL.<span style="color:#c0f">Query</span>().<span style="color:#c0f">Get</span>(<span style="color:#c30">&#34;value&#34;</span>)
        p.API.<span style="color:#c0f">KVSet</span>(key, []<span style="color:#366">byte</span>(value))
    <span style="color:#069;font-weight:bold">case</span> http.MethodDelete:
        p.API.<span style="color:#c0f">KVDelete</span>(key)
    }
}
</code></pre></div><p>Any standard error from your plugin will now be captured in the server logs, including output from the standard <a href="https://golang.org/pkg/log/">log</a> package, but there are also explicit API methods for emitting structured logs:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> (p <span style="color:#555">*</span>MyPlugin) <span style="color:#c0f">ServeHTTP</span>(c <span style="color:#555">*</span>plugin.Context, w http.ResponseWriter, r <span style="color:#555">*</span>http.Request) {
    p.API.<span style="color:#c0f">LogDebug</span>(<span style="color:#c30">&#34;received http request&#34;</span>, <span style="color:#c30">&#34;user_agent&#34;</span>, r.<span style="color:#c0f">UserAgent</span>())
    <span style="color:#069;font-weight:bold">if</span> r.<span style="color:#c0f">Referer</span>() <span style="color:#555">==</span> <span style="color:#c30">&#34;&#34;</span> {
        p.API.<span style="color:#c0f">LogError</span>(<span style="color:#c30">&#34;missing referer&#34;</span>)
    }
}
</code></pre></div><p>This would generate something like the following in your server logs:</p>
<pre><code>{&quot;level&quot;:&quot;debug&quot;,&quot;ts&quot;:1531494669.83655,&quot;caller&quot;:&quot;app/plugin_api.go:254&quot;,&quot;msg&quot;:&quot;received http request&quot;,&quot;plugin_id&quot;:&quot;my-plugin&quot;,&quot;user_agent&quot;:&quot;HTTPie/0.9.9&quot;}
{&quot;level&quot;:&quot;error&quot;,&quot;ts&quot;:1531494669.8368616,&quot;caller&quot;:&quot;app/plugin_api.go:260&quot;,&quot;msg&quot;:&quot;missing referer&quot;,&quot;plugin_id&quot;:&quot;&quot;my-plugin&quot;}
</code></pre><h3 id="web-app-changes">Web App Changes&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#web-app-changes"></i></a> </h3>
<p>The changes to web app plugins are more significant than server plugins.</p>
<h4 id="entry-point-1">Entry Point&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#entry-point-1"></i></a> </h4>
<p>The plugin entry point was previously registered by directly manipulating a global variable:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#366">window</span>.plugins[<span style="color:#c30">&#39;my-plugin&#39;</span>] <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> MyPlugin();
</code></pre></div><p>Instead, use the globally exported <code>registerPlugin</code> method:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#366">window</span>.registerPlugin(<span style="color:#c30">&#39;my-plugin&#39;</span>, <span style="color:#069;font-weight:bold">new</span> MyPlugin());
</code></pre></div><h4 id="externalizing-dependencies">Externalizing Dependencies&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#externalizing-dependencies"></i></a> </h4>
<p>The plugins beta suggested relying on the global export of common libraries from the web app:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#069;font-weight:bold">const</span> React <span style="color:#555">=</span> <span style="color:#366">window</span>.react;
</code></pre></div><p>While this remains supported, it is more natural to leverage Webpack <a href="https://webpack.js.org/configuration/externals/">Externals</a>. Configure this in your <code>.webpack.config.js</code>:</p>
<pre><code>module.exports = {
    // ...
    externals: {
        react: 'react',
    },
    // ...
};
</code></pre><p>and then import your modules naturally:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#069;font-weight:bold">import</span> React from <span style="color:#c30">&#39;react&#39;</span>;
</code></pre></div><p>Note however that the exported variables have changed to the following:</p>
<table>
<thead>
<tr>
<th>Prior to Mattermost 5.2</th>
<th>Mattermost 5.2</th>
</tr>
</thead>
<tbody>
<tr>
<td>window.react</td>
<td>window.React</td>
</tr>
<tr>
<td>window[&lsquo;react-dom&rsquo;]</td>
<td>window.ReactDom</td>
</tr>
<tr>
<td>window.redux</td>
<td>window.Redux</td>
</tr>
<tr>
<td>window[&lsquo;react-redux&rsquo;]</td>
<td>window.ReactRedux</td>
</tr>
<tr>
<td>window[&lsquo;react-bootstrap&rsquo;]</td>
<td>window.ReactBootstrap</td>
</tr>
<tr>
<td>window[&lsquo;post-utils&rsquo;]</td>
<td>window.PostUtils</td>
</tr>
<tr>
<td><em>N/A</em></td>
<td>window.PropTypes</td>
</tr>
</tbody>
</table>
<h4 id="initialization">Initialization&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#initialization"></i></a> </h4>
<p>The <code>initialize</code> callback used to receive a <code>registerComponents</code> callback to configure components, post types and main menu overrides:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#069;font-weight:bold">import</span> ChannelHeaderButton from <span style="color:#c30">&#39;./components/channel_header_button&#39;</span>;
<span style="color:#069;font-weight:bold">import</span> MobileChannelHeaderButton from <span style="color:#c30">&#39;./components/mobile_channel_header_button&#39;</span>;
<span style="color:#069;font-weight:bold">import</span> PostTypeZoom from <span style="color:#c30">&#39;./components/post_type_zoom&#39;</span>;
<span style="color:#069;font-weight:bold">import</span> {configureZoom} from <span style="color:#c30">&#39;./actions/zoom&#39;</span>;

<span style="color:#069;font-weight:bold">class</span> MyPlugin {
    initialize(registerComponents) {
        registerComponents(
            {ChannelHeaderButton, MobileChannelHeaderButton},
            {custom_zoom<span style="color:#555">:</span> PostTypeZoom},
            {
                id<span style="color:#555">:</span> <span style="color:#c30">&#39;zoom-configuration&#39;</span>,
                text<span style="color:#555">:</span> <span style="color:#c30">&#39;Zoom Configuration&#39;</span>,
                action<span style="color:#555">:</span> configureZoom,
            },
        );
    }
}
</code></pre></div><p>The <code>initialize</code> callback now receives an instance of the plugin <a href="../../../extend/plugins/webapp/reference/#registry">registry</a>. In some cases, the registry&rsquo;s API now requires a more discrete breakdown of the registered component to allow the web app to handle various rendering scenarios:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#069;font-weight:bold">import</span> ChannelHeaderButtonIcon from <span style="color:#c30">&#39;./components/channel_header_button/icon&#39;</span>;
<span style="color:#069;font-weight:bold">import</span> MobileChannelHeaderButton from <span style="color:#c30">&#39;./components/mobile_channel_header_button&#39;</span>;
<span style="color:#069;font-weight:bold">import</span> PostTypeZoom from <span style="color:#c30">&#39;./components/post_type_zoom&#39;</span>;
<span style="color:#069;font-weight:bold">import</span> {startZoomMeeting, configureZoom} from <span style="color:#c30">&#39;./actions/zoom&#39;</span>;

<span style="color:#069;font-weight:bold">class</span> MyPlugin {
    initialize(registry) {
        registry.registerChannelHeaderButtonAction(
            ChannelHeaderButtonIcon,
            startZoomMeeting,
            <span style="color:#c30">&#39;Start Zoom Meeting&#39;</span>,
        );

        registry.registerPostTypeComponent(<span style="color:#c30">&#39;custom_zoom&#39;</span>, PostTypeZoom);

        registry.registerMainMenuAction(
            <span style="color:#c30">&#39;Zoom Configuration&#39;</span>,
            configureZoom,
            MobileChannelHeaderButton,
        );
    }
}
</code></pre></div><p>Restructuring your plugin to use the new registry API will likely prove to be the hardest part of migrating.</p>


                </div>
            </div>
        </div>
    </div>
    <footer class="text-center">
    <div class="container-fluid">
        <div class="footer__copyright">Â© Mattermost, Inc. All Rights Reserved.</div>
        <div class="footer__icons">
            <a href="https://www.facebook.com/Mattermost-2300985916642531/"><i class="fa fa-facebook"></i></a>
            <a href="https://twitter.com/mattermost"><i class="fa fa-twitter"></i></a>
            <a href="https://www.youtube.com/channel/UCNR05H72hi692y01bWaFXNA"><i class="fa fa-youtube"></i></a>
        </div>
    </div>
</footer>

</body>
</html>
